const translations = {
    en: {
        about: "About Us",
        aid: "Humanitarian Aid",
        support: "Support for Refugees",
        involved: "Get Involved",
        news: "News",
        missionTitle: "Our Mission",
        missionText: "The Utah Ukrainian Association is a nonprofit uniting Utah's Ukrainian community to support Ukraine and help newcomers adapt to life in the U.S.",
        missionText2: "Join us in fostering unity and sharing Ukrainian culture!",
        aidTitle: "Humanitarian Aid",
        aidText: "Test",
        supportTitle: "Support for Refugees",
        service1: "Housing",
        service2: "Driver's license",
        service3: "Resume and Job",
        service4: "Training and Studying",
        service5: "English language",
        details: "Details",
        volunteer: "Volunteer",
        volunteerText: "Join our team and make a difference.",
        partner: "Become a Partner",
        partnerText: "Collaborate with us to create impact.",
        stayInformed: "Stay Informed",
        stayInformedText: "Get the latest updates and news.",
        learnMore: "Learn More",
        aboutUs: "About Us",
        missionLink: "Our Mission",
        teamLink: "Our Team",
        careersLink: "Careers",
        ourWork: "Our Work",
        crisisLink: "Crisis Response",
        educationLink: "Education",
        healthLink: "Health",
        getInvolvedFooter: "Get Involved",
        donateLink: "Donate",
        volunteerLink: "Volunteer",
        partnerLink: "Partner",
        followUs: "Follow Us",
        howWeHelp: "How We Help",
        reportsLink: "Reports & Results",
        housingLink: "Housing",
        licenseLink: "Driver’s License",
        employmentLink: "Employment & Career",
        languageLink: "English Language",
        wellnessLink: "Youth Wellness Program",
        assistanceLink: "How to Get Assistance",
        newsletterLink: "Sign up for Newsletter",
        eventsLink: "Calendar",
        blogLink: "Blog",
        contactLink: "Contact Us",
    },
    uk: {
        about: "Про нас",
        aid: "Гуманітарна допомога",
        support: "Підтримка біженців",
        involved: "Долучитися",
        news: "Події",
        calendar: "Календар Подій",
        missionTitle: "Наша місія",
        missionText: "Асоціація українців Юти — це неприбуткова організація, яка об'єднує українську громаду Юти для підтримки України та допомоги новоприбулим адаптуватися до життя в США.",
        missionText2: "Приєднуйтесь до нас у зміцненні єдності та поширенні української культури!",
        aidTitle: "Гуманітарна допомога",
        aidText: "Тест",
        supportTitle: "Підтримка біженців",
        service1: "Житло",
        service2: "Водійські права",
        service3: "Резюме та Робота",
        service4: "Навчання",
        service5: "Англійська мова",
        details: "Детальніше",
        volunteer: "Волонтер",
        volunteerText: "Приєднуйтесь до нашої команди.",
        partner: "Стати партнером",
        partnerText: "Співпрацюйте з нами.",
        stayInformed: "Будьте в курсі",
        stayInformedText: "Отримуйте останні новини.",
        learnMore: "Дізнатися більше",
        aboutUs: "Про нас",
        missionLink: "Наша місія",
        teamLink: "Наша команда",
        careersLink: "Кар’єра",
        ourWork: "Наша робота",
        crisisLink: "Реагування на кризи",
        educationLink: "Освіта",
        healthLink: "Здоров’я",
        getInvolvedFooter: "Долучитися",
        donateLink: "Пожертвувати",
        volunteerLink: "Волонтер",
        partnerLink: "Партнер",
        followUs: "Слідкуйте за нами",
        howWeHelp: "Як ми допомагаємо",
        reportsLink: "Звіти та результати",
        housingLink: "Житло",
        licenseLink: "Посвідчення водія",
        employmentLink: "Робота та кар’єра",
        languageLink: "Англійська мова",
        wellnessLink: "Програма для молоді",
        assistanceLink: "Як отримати допомогу",
        newsletterLink: "Підписатися на розсилку",
        eventsLink: "Календар",
        blogLink: "Блог",
        contactLink: "Наші контакти",
    },
    ru: {
        about: "О нас",
        aid: "Гуманитарная помощь",
        support: "Поддержка беженцев",
        involved: "Присоединиться",
        news: "Новости",
        calendar: "Календарь Событий",
        missionTitle: "Наша миссия",
        missionText: "Ассоциация украинцев Юты — некоммерческая организация, объединяющая украинское сообщество Юты для поддержки Украины и помощи новоприбывшим адаптироваться к жизни в США. Мы предоставляем жилье, помощь в трудоустройстве и образовании, а так же сотрудничаем в гуманитарных миссиях.",
        missionText2: "Присоединяйтесь к нам в укреплении единства и распространении украинской культуры!",
        aidTitle: "Гуманитарная помощь",
        aidText: "Тест",
        supportTitle: "Поддержка беженцев",
        service1: "Проживание",
        service2: "Водительское удостоверение",
        service3: "Резюме и Работа",
        service4: "Обучение",
        service5: "Английский язык",
        details: "Подробнее",
        volunteer: "Волонтер",
        volunteerText: "Присоединяйтесь к нашей команде.",
        partner: "Стать партнером",
        partnerText: "Сотрудничайте с нами.",
        stayInformed: "Будьте в курсе",
        stayInformedText: "Получайте последние новости.",
        learnMore: "Узнать больше",
        aboutUs: "О нас",
        missionLink: "Наша миссия",
        teamLink: "Наша команда",
        careersLink: "Карьера",
        ourWork: "Наша работа",
        crisisLink: "Реагирование на кризисы",
        educationLink: "Образование",
        healthLink: "Здоровье",
        getInvolvedFooter: "Присоединиться",
        donateLink: "Пожертвовать",
        volunteerLink: "Волонтерство",
        partnerLink: "Партнерство",
        followUs: "Следите за нами",
        howWeHelp: "Как мы помогаем",
        reportsLink: "Отчеты и результаты",
        housingLink: "Жилье",
        licenseLink: "Водительские права",
        employmentLink: "Работа и карьера",
        languageLink: "Английский язык",
        wellnessLink: "Программа для молодежи",
        assistanceLink: "Как получить помощь",
        newsletterLink: "Подписаться на рассылку",
        eventsLink: "Календарь",
        blogLink: "Блог",
        contactLink: "Наши контакты",
    },
};

const languageSwitcher = document.querySelector(".language-switcher");
const currentLangButton = languageSwitcher.querySelector("button");
const langList = languageSwitcher.querySelector("ul");

const menuItems = document.querySelectorAll("nav ul li");
const overlay = document.getElementById("overlay");

let currentLang = "en";

function updateTexts(lang) {
    document.querySelectorAll("[data-lang]").forEach((element) => {
        const key = element.getAttribute("data-lang");
        if (translations[lang][key]) {
            if (element.closest('nav > ul > li > a')) {
                const maxLength = {
                    'en': 20,
                    'uk': 13,
                    'ru': 12
                }[lang];

                let text = translations[lang][key];
                if (text.length > maxLength) {
                    text = text.slice(0, maxLength) + '..';
                }
                element.textContent = text;
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
    currentLangButton.textContent = lang.toUpperCase();
    checkMenuOverflow();
}

langList.querySelectorAll("li").forEach((item) => {
    item.addEventListener("click", () => {
        const lang = item.getAttribute("data-lang");
        currentLang = lang;
        updateTexts(lang);
    });
});

updateTexts(currentLang);

menuItems.forEach((item) => {
    item.addEventListener("mouseenter", () => {
        overlay.classList.add("active");
    });

    item.addEventListener("mouseleave", () => {
        overlay.classList.remove("active");
    });
});

function isElementInViewport(el) {
    const rect = el.getBoundingClientRect();
    return (
        rect.top <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.bottom >= 0 &&
        rect.left <= (window.innerWidth || document.documentElement.clientWidth) &&
        rect.right >= 0
    );
}

function handleScroll() {
    const aidImage = document.querySelector('.aid img');
    const supportImage = document.querySelector('.support img');

    if (isElementInViewport(aidImage)) {
        aidImage.classList.add('slide-in');
    }

    if (isElementInViewport(supportImage)) {
        supportImage.classList.add('slide-in');
    }
}

window.addEventListener('scroll', handleScroll);
window.addEventListener('load', handleScroll);

const mobileMenu = document.getElementById("mobile-menu");
const navMenu = document.getElementById("nav-menu");

function toggleMenu() {
    navMenu.classList.toggle("active");
    overlay.classList.toggle("active");
}

function closeNoticeHandler() {
    document.getElementById('websiteNoticeOverlay').style.display = 'none';
    document.body.style.overflow = 'auto';
}

document.getElementById('closeNotice').addEventListener('click', closeNoticeHandler);
document.body.style.overflow = 'hidden';

mobileMenu.addEventListener("click", toggleMenu);

document.addEventListener("click", (event) => {
    if (!navMenu.contains(event.target) && !mobileMenu.contains(event.target)) {
        navMenu.classList.remove("active");
        overlay.classList.remove("active");
    }
});

function setupEventSwipe() {
    if (window.innerWidth > 768) return;

    const eventsContent = document.querySelector('.events-content');
    let startX = 0;
    let isScrolling = false;

    eventsContent.addEventListener('touchstart', (e) => {
        startX = e.touches[0].pageX;
        isScrolling = true;
    }, { passive: true });

    eventsContent.addEventListener('touchmove', (e) => {
        if (!isScrolling) return;
        const xDiff = Math.abs(e.touches[0].pageX - startX);
        const yDiff = Math.abs(e.touches[0].pageY - startY);

        if (xDiff > yDiff) {
            e.preventDefault();
        }
    }, { passive: false });

    eventsContent.addEventListener('touchend', () => {
        isScrolling = false;
    }, { passive: true });
}

function initSwipeIndicators() {
    if (window.innerWidth > 768) return;

    const eventsContent = document.querySelector('.events-content');
    const indicatorsContainer = document.querySelector('.swipe-indicators');
    const events = document.querySelectorAll('.event');

    indicatorsContainer.innerHTML = '';
    events.forEach((_, index) => {
        const indicator = document.createElement('div');
        indicator.className = 'swipe-indicator' + (index === 0 ? ' active' : '');
        indicatorsContainer.appendChild(indicator);
    });

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const index = Array.from(events).indexOf(entry.target);
                document.querySelectorAll('.swipe-indicator').forEach((indicator, i) => {
                    indicator.classList.toggle('active', i === index);
                });
            }
        });
    }, { threshold: 0.5 });

    events.forEach(event => observer.observe(event));
}

window.addEventListener('load', () => {
    initSwipeIndicators();
    setupEventSwipe();
});

window.addEventListener('resize', initSwipeIndicators);

const header = document.querySelector('header');
const blackLogo = new Image();
blackLogo.src = "img/Logo_black.webp";
const whiteLogo = new Image();
whiteLogo.src = "img/Logo_white.webp";

function updateHeader() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    if (scrollTop > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
}

window.addEventListener('scroll', updateHeader);
updateHeader();

function checkMenuOverflow() {
    const nav = document.querySelector('nav');
    const navUl = nav.querySelector('ul');
    const header = document.querySelector('header');

    if (navUl.scrollWidth > nav.offsetWidth) {
        header.classList.add('menu-overflow');
    } else {
        header.classList.remove('menu-overflow');
    }
}



/*
function setupEventsCarousel() {
    const eventsContent = document.querySelector('.events-content');
    const eventList = document.querySelector('.event-list');
    const events = document.querySelectorAll('.event');

    if (window.innerWidth > 768) {
        // Клонируем события для бесшовной анимации
        events.forEach(event => {
            const clone = event.cloneNode(true);
            eventList.appendChild(clone);
        });

        // Перезапускаем анимацию при завершении
        eventList.addEventListener('animationiteration', () => {
            eventList.style.animation = 'none';
            eventList.offsetHeight; // Триггер рефлоу
            eventList.style.animation = 'scrollEvents 30s linear infinite';
        });
    } else {
        // Для мобильных оставляем обычную прокрутку
        eventList.style.animation = 'none';
    }
}

// Вызываем функцию при загрузке и изменении размера окна
window.addEventListener('load', setupEventsCarousel);
window.addEventListener('resize', setupEventsCarousel); */



// Управление стрелками
document.querySelector('.left-arrow').addEventListener('click', () => {
    document.querySelector('.events-content').scrollBy({
        left: -300,
        behavior: 'smooth'
    });
});

document.querySelector('.right-arrow').addEventListener('click', () => {
    document.querySelector('.events-content').scrollBy({
        left: 300,
        behavior: 'smooth'
    });
});

// Управление колесиком мыши
const eventsContent = document.querySelector('.events-content');
let isScrolling = false;

eventsContent.addEventListener('wheel', (e) => {
    e.preventDefault();

    if (isScrolling) return;
    isScrolling = true;

    const scrollAmount = e.deltaY > 0 ? 300 : -300;
    eventsContent.scrollBy({
        left: scrollAmount,
        behavior: 'smooth'
    });

    setTimeout(() => {
        isScrolling = false;
    }, 500);
}, { passive: false });

// Скрытие стрелок при достижении края
function checkScrollPosition() {
    const arrows = document.querySelectorAll('.scroll-arrow');
    const scrollLeft = eventsContent.scrollLeft;
    const maxScroll = eventsContent.scrollWidth - eventsContent.clientWidth;

    arrows[0].style.display = scrollLeft <= 10 ? 'none' : 'flex';
    arrows[1].style.display = scrollLeft >= maxScroll - 10 ? 'none' : 'flex';
}

eventsContent.addEventListener('scroll', checkScrollPosition);
window.addEventListener('resize', checkScrollPosition);
window.addEventListener('load', checkScrollPosition);


// Плавная прокрутка для якорных ссылок
document.addEventListener('DOMContentLoaded', function() {
    // Находим все ссылки с хешем
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            
            // Пропускаем ссылки на другие страницы
            if (href === '#' || href.includes('.html')) return;
            
            e.preventDefault();
            
            const targetId = href.substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                // Закрываем мобильное меню если открыто
                const navMenu = document.getElementById('nav-menu');
                if (navMenu && navMenu.classList.contains('active')) {
                    navMenu.classList.remove('active');
                    overlay.classList.remove('active');
                }
                
                // Плавная прокрутка с учетом высоты шапки
                const headerHeight = document.querySelector('header').offsetHeight;
                const targetPosition = targetElement.offsetTop - headerHeight - 20;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
                
                // Обновляем URL без перезагрузки
                history.pushState(null, null, href);
            }
        });
    });
    



    // Улучшенная плавная прокрутка с учетом динамической высоты шапки
document.addEventListener('DOMContentLoaded', function() {
    // Функция для получения ТОЧНОЙ высоты шапки в текущий момент
    function getCurrentHeaderHeight() {
        const header = document.querySelector('header');
        if (!header) return 0;
        
        // Если шапка имеет классы при скролле (например, scrolled)
        // возвращаем актуальную высоту
        return header.offsetHeight;
    }

    // Функция для корректировки прокрутки
    function scrollToElementWithOffset(targetId, offset = 20) {
        const targetElement = document.getElementById(targetId);
        
        if (!targetElement) return;
        
        // Закрываем мобильное меню
        const navMenu = document.getElementById('nav-menu');
        if (navMenu && navMenu.classList.contains('active')) {
            navMenu.classList.remove('active');
            overlay.classList.remove('active');
        }
        
        // Получаем текущую высоту шапки
        const headerHeight = getCurrentHeaderHeight();
        const additionalOffset = offset; // Дополнительный отступ
        const totalOffset = headerHeight + additionalOffset;
        
        // Получаем позицию элемента относительно верха документа
        const elementTop = targetElement.getBoundingClientRect().top + window.pageYOffset;
        
        // Вычисляем финальную позицию прокрутки
        const scrollPosition = elementTop - totalOffset;
        
        // Плавная прокрутка
        window.scrollTo({
            top: scrollPosition,
            behavior: 'smooth'
        });
        
        // Добавляем временный атрибут для визуальной подсветки
        targetElement.setAttribute('data-scrolled-to', 'true');
        setTimeout(() => {
            targetElement.removeAttribute('data-scrolled-to');
        }, 2000);
    }

    // Обработчик кликов по всем якорным ссылкам
    document.addEventListener('click', function(e) {
        // Проверяем, является ли элемент якорной ссылкой
        const anchor = e.target.closest('a[href^="#"]');
        
        if (!anchor) return;
        
        const href = anchor.getAttribute('href');
        
        // Пропускаем пустые ссылки и ссылки на другие страницы
        if (href === '#' || href.includes('.html')) return;
        
        e.preventDefault();
        
        const targetId = href.substring(1);
        
        // Проверяем существование элемента
        if (document.getElementById(targetId)) {
            // Небольшая задержка для гарантии расчета правильной высоты
            setTimeout(() => {
                scrollToElementWithOffset(targetId);
            }, 50);
            
            // Обновляем URL
            history.pushState(null, null, href);
        }
    });

    // Обработка якорных ссылок при загрузке страницы
    function handleInitialHash() {
        if (window.location.hash) {
            const hash = window.location.hash.substring(1);
            
            // Ждем полной загрузки всех стилей и контента
            if (document.readyState === 'complete') {
                setTimeout(() => {
                    scrollToElementWithOffset(hash);
                }, 300);
            } else {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        scrollToElementWithOffset(hash);
                    }, 300);
                });
            }
        }
    }

    // Вызываем обработку хеша
    handleInitialHash();
    
    // Также обрабатываем изменение хеша в URL (если пользователь меняет его вручную)
    window.addEventListener('hashchange', function() {
        if (window.location.hash) {
            const hash = window.location.hash.substring(1);
            setTimeout(() => {
                scrollToElementWithOffset(hash);
            }, 100);
        }
    });
});

// Дополнительная функция для принудительного пересчета
function forceScrollToSection(sectionId) {
    const header = document.querySelector('header');
    const section = document.getElementById(sectionId);
    
    if (!section || !header) return;
    
    // Сбрасываем скролл
    window.scrollTo(0, 0);
    
    // Даем время на перерисовку
    setTimeout(() => {
        const headerHeight = header.offsetHeight;
        const sectionTop = section.getBoundingClientRect().top + window.pageYOffset;
        
        window.scrollTo({
            top: sectionTop - headerHeight - 20,
            behavior: 'smooth'
        });
    }, 100);
}
});