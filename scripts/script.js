const translations = {
    en: {
        about: "About Us",
        aid: "Humanitarian Aid",
        support: "Support for Refugees",
        involved: "Get Involved",
        news: "News",
        missionTitle: "Our Mission",
        missionText: "The Utah Ukrainian Association is a nonprofit uniting Utah's Ukrainian community to support Ukraine and help newcomers adapt to life in the U.S.",
        missionText2: "Join us in fostering unity and sharing Ukrainian culture!",
        aidTitle: "Humanitarian Aid",
        aidText: "Test",
        supportTitle: "Support for Refugees",
        service1: "Housing",
        service2: "Driver's license",
        service3: "Resume and Job",
        service4: "Training and Studying",
        service5: "English language",
        details: "Details",
        volunteer: "Volunteer",
        volunteerText: "Join our team and make a difference.",
        partner: "Become a Partner",
        partnerText: "Collaborate with us to create impact.",
        stayInformed: "Stay Informed",
        stayInformedText: "Get the latest updates and news.",
        learnMore: "Learn More",
        aboutUs: "About Us",
        missionLink: "Our Mission",
        teamLink: "Our Team",
        careersLink: "Careers",
        ourWork: "Our Work",
        crisisLink: "Crisis Response",
        educationLink: "Education",
        healthLink: "Health",
        getInvolvedFooter: "Get Involved",
        donateLink: "Donate",
        volunteerLink: "Volunteer",
        partnerLink: "Partner",
        followUs: "Follow Us",
        howWeHelp: "How We Help",
        reportsLink: "Reports & Results",
        housingLink: "Housing",
        licenseLink: "Driver’s License",
        employmentLink: "Employment & Career",
        languageLink: "English Language",
        wellnessLink: "Youth Wellness Program",
        assistanceLink: "How to Get Assistance",
        newsletterLink: "Sign up for Newsletter",
        eventsLink: "Upcoming Events",
        blogLink: "Blog",
        contactLink: "Contact Us",
    },
    uk: {
        about: "Про нас",
        aid: "Гуманітарна допомога",
        support: "Підтримка біженців",
        involved: "Долучитися",
        news: "Новини та події",
        missionTitle: "Наша місія",
        missionText: "Асоціація українців Юти — це неприбуткова організація, яка об'єднує українську громаду Юти для підтримки України та допомоги новоприбулим адаптуватися до життя в США.",
        missionText2: "Приєднуйтесь до нас у зміцненні єдності та поширенні української культури!",
        aidTitle: "Гуманітарна допомога",
        aidText: "Тест",
        supportTitle: "Підтримка біженців",
        service1: "Житло",
        service2: "Водійські права",
        service3: "Резюме та Робота",
        service4: "Навчання",
        service5: "Англійська мова",
        details: "Детальніше",
        volunteer: "Волонтер",
        volunteerText: "Приєднуйтесь до нашої команди.",
        partner: "Стати партнером",
        partnerText: "Співпрацюйте з нами.",
        stayInformed: "Будьте в курсі",
        stayInformedText: "Отримуйте останні новини.",
        learnMore: "Дізнатися більше",
        aboutUs: "Про нас",
        missionLink: "Наша місія",
        teamLink: "Наша команда",
        careersLink: "Кар’єра",
        ourWork: "Наша робота",
        crisisLink: "Реагування на кризи",
        educationLink: "Освіта",
        healthLink: "Здоров’я",
        getInvolvedFooter: "Долучитися",
        donateLink: "Пожертвувати",
        volunteerLink: "Волонтер",
        partnerLink: "Партнер",
        followUs: "Слідкуйте за нами",
        howWeHelp: "Як ми допомагаємо",
        reportsLink: "Звіти та результати",
        housingLink: "Житло",
        licenseLink: "Посвідчення водія",
        employmentLink: "Робота та кар’єра",
        languageLink: "Англійська мова",
        wellnessLink: "Програма для молоді",
        assistanceLink: "Як отримати допомогу",
        newsletterLink: "Підписатися на розсилку",
        eventsLink: "Майбутні події",
        blogLink: "Блог",
        contactLink: "Наші контакти",
    },
    ru: {
        about: "О нас",
        aid: "Гуманитарная помощь",
        support: "Поддержка беженцев",
        involved: "Присоединиться",
        news: "Новости и события",
        missionTitle: "Наша миссия",
        missionText: "Ассоциация украинцев Юты — некоммерческая организация, объединяющая украинское сообщество Юты для поддержки Украины и помощи новоприбывшим адаптироваться к жизни в США. Мы предоставляем жилье, помощь в трудоустройстве и образовании, а так же сотрудничаем в гуманитарных миссиях.",
        missionText2: "Присоединяйтесь к нам в укреплении единства и распространении украинской культуры!",
        aidTitle: "Гуманитарная помощь",
        aidText: "Тест",
        supportTitle: "Поддержка беженцев",
        service1: "Проживание",
        service2: "Водительское удостоверение",
        service3: "Резюме и Работа",
        service4: "Обучение",
        service5: "Английский язык",
        details: "Подробнее",
        volunteer: "Волонтер",
        volunteerText: "Присоединяйтесь к нашей команде.",
        partner: "Стать партнером",
        partnerText: "Сотрудничайте с нами.",
        stayInformed: "Будьте в курсе",
        stayInformedText: "Получайте последние новости.",
        learnMore: "Узнать больше",
        aboutUs: "О нас",
        missionLink: "Наша миссия",
        teamLink: "Наша команда",
        careersLink: "Карьера",
        ourWork: "Наша работа",
        crisisLink: "Реагирование на кризисы",
        educationLink: "Образование",
        healthLink: "Здоровье",
        getInvolvedFooter: "Присоединиться",
        donateLink: "Пожертвовать",
        volunteerLink: "Волонтерство",
        partnerLink: "Партнерство",
        followUs: "Следите за нами",
        howWeHelp: "Как мы помогаем",
        reportsLink: "Отчеты и результаты",
        housingLink: "Жилье",
        licenseLink: "Водительские права",
        employmentLink: "Работа и карьера",
        languageLink: "Английский язык",
        wellnessLink: "Программа для молодежи",
        assistanceLink: "Как получить помощь",
        newsletterLink: "Подписаться на рассылку",
        eventsLink: "Предстоящие события",
        blogLink: "Блог",
        contactLink: "Наши контакты",
    },
};

const languageSwitcher = document.querySelector(".language-switcher");
const currentLangButton = languageSwitcher.querySelector("button");
const langList = languageSwitcher.querySelector("ul");

const menuItems = document.querySelectorAll("nav ul li");
const overlay = document.getElementById("overlay");

let currentLang = "en";

function updateTexts(lang) {
    document.querySelectorAll("[data-lang]").forEach((element) => {
        const key = element.getAttribute("data-lang");
        if (translations[lang][key]) {
            if (element.closest('nav > ul > li > a')) {
                const maxLength = {
                    'en': 20,
                    'uk': 13,
                    'ru': 12
                }[lang];

                let text = translations[lang][key];
                if (text.length > maxLength) {
                    text = text.slice(0, maxLength) + '..';
                }
                element.textContent = text;
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
    currentLangButton.textContent = lang.toUpperCase();
    checkMenuOverflow();
}

langList.querySelectorAll("li").forEach((item) => {
    item.addEventListener("click", () => {
        const lang = item.getAttribute("data-lang");
        currentLang = lang;
        updateTexts(lang);
    });
});

updateTexts(currentLang);

menuItems.forEach((item) => {
    item.addEventListener("mouseenter", () => {
        overlay.classList.add("active");
    });

    item.addEventListener("mouseleave", () => {
        overlay.classList.remove("active");
    });
});

function isElementInViewport(el) {
    const rect = el.getBoundingClientRect();
    return (
        rect.top <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.bottom >= 0 &&
        rect.left <= (window.innerWidth || document.documentElement.clientWidth) &&
        rect.right >= 0
    );
}

function handleScroll() {
    const aidImage = document.querySelector('.aid img');
    const supportImage = document.querySelector('.support img');

    if (isElementInViewport(aidImage)) {
        aidImage.classList.add('slide-in');
    }

    if (isElementInViewport(supportImage)) {
        supportImage.classList.add('slide-in');
    }
}

window.addEventListener('scroll', handleScroll);
window.addEventListener('load', handleScroll);

const mobileMenu = document.getElementById("mobile-menu");
const navMenu = document.getElementById("nav-menu");

function toggleMenu() {
    navMenu.classList.toggle("active");
    overlay.classList.toggle("active");
}

function closeNoticeHandler() {
    document.getElementById('websiteNoticeOverlay').style.display = 'none';
    document.body.style.overflow = 'auto';
}

document.getElementById('closeNotice').addEventListener('click', closeNoticeHandler);
document.body.style.overflow = 'hidden';

mobileMenu.addEventListener("click", toggleMenu);

document.addEventListener("click", (event) => {
    if (!navMenu.contains(event.target) && !mobileMenu.contains(event.target)) {
        navMenu.classList.remove("active");
        overlay.classList.remove("active");
    }
});

function setupEventSwipe() {
    if (window.innerWidth > 768) return;

    const eventsContent = document.querySelector('.events-content');
    let startX = 0;
    let isScrolling = false;

    eventsContent.addEventListener('touchstart', (e) => {
        startX = e.touches[0].pageX;
        isScrolling = true;
    }, { passive: true });

    eventsContent.addEventListener('touchmove', (e) => {
        if (!isScrolling) return;
        const xDiff = Math.abs(e.touches[0].pageX - startX);
        const yDiff = Math.abs(e.touches[0].pageY - startY);

        if (xDiff > yDiff) {
            e.preventDefault();
        }
    }, { passive: false });

    eventsContent.addEventListener('touchend', () => {
        isScrolling = false;
    }, { passive: true });
}

function initSwipeIndicators() {
    if (window.innerWidth > 768) return;

    const eventsContent = document.querySelector('.events-content');
    const indicatorsContainer = document.querySelector('.swipe-indicators');
    const events = document.querySelectorAll('.event');

    indicatorsContainer.innerHTML = '';
    events.forEach((_, index) => {
        const indicator = document.createElement('div');
        indicator.className = 'swipe-indicator' + (index === 0 ? ' active' : '');
        indicatorsContainer.appendChild(indicator);
    });

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const index = Array.from(events).indexOf(entry.target);
                document.querySelectorAll('.swipe-indicator').forEach((indicator, i) => {
                    indicator.classList.toggle('active', i === index);
                });
            }
        });
    }, { threshold: 0.5 });

    events.forEach(event => observer.observe(event));
}

window.addEventListener('load', () => {
    initSwipeIndicators();
    setupEventSwipe();
});

window.addEventListener('resize', initSwipeIndicators);

const header = document.querySelector('header');
const blackLogo = new Image();
blackLogo.src = "img/Logo_black.webp";
const whiteLogo = new Image();
whiteLogo.src = "img/Logo_white.webp";

function updateHeader() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    if (scrollTop > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
}

window.addEventListener('scroll', updateHeader);
updateHeader();

function checkMenuOverflow() {
    const nav = document.querySelector('nav');
    const navUl = nav.querySelector('ul');
    const header = document.querySelector('header');

    if (navUl.scrollWidth > nav.offsetWidth) {
        header.classList.add('menu-overflow');
    } else {
        header.classList.remove('menu-overflow');
    }
}